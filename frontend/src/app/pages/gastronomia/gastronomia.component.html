<!-- HERO -->
<section class="hero">
    <div class="overlay"></div>
    <div class="contenido">
        <h1>Restaurantes cerca de Xalapa</h1>
        <p>Descubre los mejores lugares para comer en la ciudad.</p>
    </div>
</section>

<!-- LAYOUT: FILTROS, LISTA, MAPA -->
<div class="layout">

    <!-- FILTROS IZQUIERDA -->
    <aside class="sidebar">
        <h3>Filtros</h3>

        <div class="filtro-section">
            <button class="btn-mapa" onclick="alert('Mapa: Pr√≥ximamente')">üó∫Ô∏è Mapa</button>
        </div>

        <div class="filtro-section">
            <h4>Precios</h4>
            <div class="precios">
                <button (click)="filtroPrecio = '$'; filtrar()" [class.activo]="filtroPrecio === '$'" class="precio-btn">$</button>

                <button (click)="filtroPrecio = '$$'; filtrar()" [class.activo]="filtroPrecio === '$$'" class="precio-btn">$$</button>

                <button (click)="filtroPrecio = '$$$'; filtrar()" [class.activo]="filtroPrecio === '$$$'" class="precio-btn">$$$</button>

                <button (click)="filtroPrecio = '$$$$'; filtrar()" [class.activo]="filtroPrecio === '$$$$'" class="precio-btn">$$$$</button>
            </div>
        </div>

        <div class="filtro-section">
            <h4>Categor√≠a</h4>

            <div class="categorias-filter">
                <label *ngFor="let cat of categorias" class="categoria-label">
                    <input type="radio" 
                           name="categoria" 
                           [value]="cat"
                           [(ngModel)]="filtroCategoria"
                           (change)="filtrar()" />
                    <span>{{ cat }}</span>
                </label>

                <label class="categoria-label">
                    <input type="radio" 
                           name="categoria"
                           value=""
                           [(ngModel)]="filtroCategoria"
                           (change)="filtrar()"/>
                    <span>Todos</span>
                </label>
            </div>
        </div>

        <button class="btn-limpiar" (click)="limpiarFiltros()">Limpiar filtros</button>
    </aside>

    <!-- LISTA DE RESTAURANTES -->
    <main class="lista">

        <div class="resultados-header">
            <p>{{ filtrados.length }} restaurantes cercanos disponibles</p>

            <select class="ordenar">
                <option>Destacados</option>
                <option>Mejor puntuado</option>
                <option>M√°s cercano</option>
            </select>
        </div>

        <div class="buscador-box">
            <input type="text" [(ngModel)]="buscador" (input)="filtrar()" placeholder="Ubicaci√≥n o restaurante" />
        </div>

        <div *ngIf="loading" class="loading">Cargando restaurantes...</div>

        <!-- TARJETAS -->
        <div class="card" *ngFor="let item of filtrados" (click)="abrirModal(item)">

            <img [src]="item.imagen" alt="{{ item.nombre }}" class="card-img" onerror="this.src='https://via.placeholder.com/500x300?text=Restaurante'" />

            <div class="card-info">

                <div class="card-top">
                    <h3>{{ item.nombre }}</h3>
                    <div class="rating">‚≠ê {{ item.rating }}</div>
                </div>

                <p class="meta-info">{{ item.precio }} ‚Ä¢ {{ item.tipo }} ‚Ä¢ {{ item.colonia }}</p>

                <p class="descripcion">{{ item.descripcion }}</p>

                <div class="tags">
                    <span *ngFor="let servicio of item.servicios" class="tag">{{ servicio }}</span>
                </div>

                <div class="time-slots">
                    <button class="time-btn" *ngFor="let hora of item.horariosDisponibles | slice:0:5">
                        {{ hora }}
                    </button>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                    <a href="javascript:void(0)" class="mas-info">M√°s informaci√≥n</a>
                    <button (click)="toggleFavorito(item.id); $event.stopPropagation()" class="btn-favorito" [ngClass]="{'favorito': isFavorito(item.id)}" style="padding: 6px 10px; font-size: 14px; border: none; cursor: pointer; border-radius: 4px; background: #f0f0f0;">
                        {{ isFavorito(item.id) ? '‚ù§Ô∏è' : 'ü§ç' }}
                    </button>
                </div>
            </div>
        </div>

        <div *ngIf="filtrados.length === 0 && !loading" class="no-resultados">
            No se encontraron restaurantes con esos filtros.
        </div>

    </main>

    <!-- MAPA -->
    <div class="mapa">
        <iframe width="100%" height="100%" style="border:0" loading="lazy" allowfullscreen src="https://www.google.com/maps/embed/v1/place?key=AIzaSyD9YZ5tMLjIlgX-7jGFLb5D7-seLh0cFrE&q=Xalapa,Veracruz">
        </iframe>
    </div>
</div>

<!-- MODAL -->
<div *ngIf="mostrarModal" class="modal-backdrop" (click)="cerrarModal()">
    <div class="modal" (click)="$event.stopPropagation()">

        <div class="modal-header">
            <h2>{{ restauranteSeleccionado?.nombre }}</h2>
            <button class="close-btn" (click)="cerrarModal()">‚úï</button>
        </div>

        <div class="modal-body">

            <div class="modal-left">
                <img [src]="restauranteSeleccionado?.imagen" alt="{{ restauranteSeleccionado?.nombre }}" onerror="this.src='https://via.placeholder.com/400x300?text=Restaurante'" />

                <div class="info-box">
                    <p><strong>üìç Ubicaci√≥n:</strong> {{ restauranteSeleccionado?.colonia }}</p>
                    <p><strong>‚òéÔ∏è Tel√©fono:</strong> {{ restauranteSeleccionado?.telefono || 'N/A' }}</p>
                    <p><strong>üïê Horario:</strong> {{ restauranteSeleccionado?.horario || 'N/A' }}</p>
                    <p><strong>üçΩÔ∏è Tipo:</strong> {{ restauranteSeleccionado?.tipo }}</p>
                </div>

                <button class="btn-maps" (click)="abrirEnMaps()">üìç Abrir en Google Maps</button>
            </div>

            <div class="modal-right">

                <div class="rating-section">
                    <h3>‚≠ê {{ restauranteSeleccionado?.rating }}</h3>
                    <p class="precio">{{ restauranteSeleccionado?.precio }}</p>
                </div>

                <div class="descripcion-completa">
                    <h4>Descripci√≥n</h4>
                    <p>{{ restauranteSeleccionado?.descripcion }}</p>
                </div>

                <div class="servicios-list">
                    <h4>Servicios</h4>
                    <ul>
                        <li *ngFor="let servicio of restauranteSeleccionado?.servicios">
                            ‚úì {{ servicio }}
                        </li>
                    </ul>
                </div>

                <div class="horarios-disponibles">
                    <h4>Horarios disponibles</h4>
                    <div class="time-slots-modal">
                        <button class="time-btn-modal" *ngFor="let hora of restauranteSeleccionado?.horariosDisponibles">
                            {{ hora }}
                        </button>
                    </div>
                </div>

                <!-- COMENTARIOS Y CALIFICACIONES -->
                <h4 style="margin-top: 20px; margin-bottom: 10px;">Comentarios ({{ resenas.length }})</h4>

                <div class="resenas-list" *ngIf="resenas.length > 0; else noResenas">
                    <div class="resena-item" *ngFor="let r of resenas" style="border: 1px solid #ddd; padding: 10px; margin: 8px 0; border-radius: 4px; font-size: 13px;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>{{ r.usuario_nombre }}</strong>
                            <span style="color: #ff9800;">‚òÖ {{ r.calificacion }}</span>
                        </div>
                        <p style="font-size: 11px; color: #999; margin: 4px 0;">{{ r.created_at | date: 'short' }}</p>
                        <p style="font-weight: bold; margin: 4px 0;">{{ r.titulo }}</p>
                        <p style="margin: 4px 0;">{{ r.texto }}</p>
                    </div>
                </div>
                <ng-template #noResenas>
                    <p style="color: #999; font-size: 13px;">No hay comentarios a√∫n.</p>
                </ng-template>

                <!-- Formulario para agregar comentario -->
                <div *ngIf="isLoggedIn" style="margin-top: 12px; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                    <button *ngIf="!showResenaForm" (click)="showResenaForm = true" style="background: #2196F3; color: white; padding: 6px 12px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Agregar comentario</button>

                    <div *ngIf="showResenaForm">
                        <div style="margin-bottom: 6px;">
                            <label style="font-size: 12px;">‚òÖ Calificaci√≥n:</label>
                            <select [(ngModel)]="resenaForm.calificacion" style="width: 100%; padding: 4px; font-size: 12px;">
                                <option [value]="1">1 - Muy malo</option>
                                <option [value]="2">2 - Malo</option>
                                <option [value]="3">3 - Regular</option>
                                <option [value]="4">4 - Bueno</option>
                                <option [value]="5">5 - Excelente</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 6px;">
                            <input type="text" [(ngModel)]="resenaForm.titulo" placeholder="T√≠tulo..." style="width: 100%; padding: 4px; font-size: 12px; box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 6px;">
                            <textarea [(ngModel)]="resenaForm.texto" placeholder="Tu comentario..." rows="3" style="width: 100%; padding: 4px; font-size: 12px; box-sizing: border-box;"></textarea>
                        </div>
                        <div style="display: flex; gap: 6px;">
                            <button (click)="addResena()" style="background: #4CAF50; color: white; padding: 6px 12px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Enviar</button>
                            <button (click)="showResenaForm = false" style="background: #ddd; color: #333; padding: 6px 12px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Cancelar</button>
                        </div>
                    </div>
                </div>

                <button class="btn-reservar" (click)="agregarAlCarrito()">üõí Agregar al carrito</button>
            </div>

        </div>
    </div>
</div>