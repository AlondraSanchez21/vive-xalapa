<!-- HERO (NO TOCAR) -->
<section class="hero">
    <div class="overlay"></div>
    <div class="contenido">
        <h1>Lugares que no te puedes perder en Xalapa</h1>
        <p>Explora los sitios m√°s hermosos, culturales y naturales de la ciudad.</p>
    </div>
</section>
<!-- FILTROS -->
<div class="filtros">
    <button (click)="filtrar('todos')" [class.activo]="categoriaActual === 'todos'">Todos</button>
    <button (click)="filtrar('naturaleza')" [class.activo]="categoriaActual === 'naturaleza'">Naturaleza</button>
    <button (click)="filtrar('hist√≥rico')" [class.activo]="categoriaActual === 'hist√≥rico'">Hist√≥rico</button>
    <button (click)="filtrar('cultural')" [class.activo]="categoriaActual === 'cultural'">Cultural</button>
</div>

<!-- GRID -->
<div class="grid">
    <div class="card" *ngFor="let lugar of lugaresFiltrados">
        <img [src]="lugar.imagen" alt="{{ lugar.nombre }}">
        <div class="info">
            <h3>{{ lugar.nombre }}</h3>
            <p>{{ lugar.descripcion }}</p>
            <div style="display: flex; gap: 8px; margin-top: 10px;">
                <button class="btn" (click)="abrirModal(lugar)">Ver m√°s</button>
                <button (click)="toggleFavorito(lugar.id)" class="btn-favorito" [ngClass]="{'favorito': isFavorito(lugar.id)}" style="padding: 8px 12px; font-size: 16px; border: none; cursor: pointer; border-radius: 4px; background: #f0f0f0;">
                    {{ isFavorito(lugar.id) ? '‚ù§Ô∏è' : 'ü§ç' }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL -->
<div class="modal-backdrop" *ngIf="mostrarModal">
    <div class="modal">
        <button class="cerrar" (click)="cerrarModal()">‚úñ</button>
        <h2>{{ lugarSeleccionado?.nombre }}</h2>
        <p class="categoria">{{ lugarSeleccionado?.categoria | titlecase }}</p>
        <img [src]="lugarSeleccionado?.imagen" alt="{{ lugarSeleccionado?.nombre }}" class="imagen-principal">
        <p>{{ lugarSeleccionado?.descripcion }}</p>

        <div class="rating" *ngIf="lugarSeleccionado?.rating">
            <span *ngFor="let star of [1,2,3,4,5]">
        <i class="fa" [ngClass]="star <= lugarSeleccionado.rating ? 'fa-star estrella' : 'fa-star-o'"></i>
      </span>
        </div>

        <!-- COMENTARIOS Y CALIFICACIONES -->
        <h4 style="margin-top: 20px; margin-bottom: 10px;">Comentarios ({{ resenas.length }})</h4>

        <div class="resenas-list" *ngIf="resenas.length > 0; else noResenas">
            <div class="resena-item" *ngFor="let r of resenas" style="border: 1px solid #ddd; padding: 10px; margin: 8px 0; border-radius: 4px; font-size: 13px;">
                <div style="display: flex; justify-content: space-between;">
                    <strong>{{ r.usuario_nombre }}</strong>
                    <span style="color: #ff9800;">‚òÖ {{ r.calificacion }}</span>
                </div>
                <p style="font-size: 11px; color: #999; margin: 4px 0;">{{ r.created_at | date: 'short' }}</p>
                <p style="font-weight: bold; margin: 4px 0;">{{ r.titulo }}</p>
                <p style="margin: 4px 0;">{{ r.texto }}</p>
            </div>
        </div>
        <ng-template #noResenas>
            <p style="color: #999; font-size: 13px;">No hay comentarios a√∫n.</p>
        </ng-template>

        <!-- Formulario para agregar comentario -->
        <div *ngIf="isLoggedIn" style="margin-top: 12px; background: #f5f5f5; padding: 10px; border-radius: 4px;">
            <button *ngIf="!showResenaForm" (click)="showResenaForm = true" style="background: #2196F3; color: white; padding: 6px 12px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Agregar comentario</button>

            <div *ngIf="showResenaForm">
                <div style="margin-bottom: 6px;">
                    <label style="font-size: 12px;">‚òÖ Calificaci√≥n:</label>
                    <select [(ngModel)]="resenaForm.calificacion" style="width: 100%; padding: 4px; font-size: 12px;">
                        <option [value]="1">1 - Muy malo</option>
                        <option [value]="2">2 - Malo</option>
                        <option [value]="3">3 - Regular</option>
                        <option [value]="4">4 - Bueno</option>
                        <option [value]="5">5 - Excelente</option>
                    </select>
                </div>
                <div style="margin-bottom: 6px;">
                    <input type="text" [(ngModel)]="resenaForm.titulo" placeholder="T√≠tulo..." style="width: 100%; padding: 4px; font-size: 12px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 6px;">
                    <textarea [(ngModel)]="resenaForm.texto" placeholder="Tu comentario..." rows="3" style="width: 100%; padding: 4px; font-size: 12px; box-sizing: border-box;"></textarea>
                </div>
                <div style="display: flex; gap: 6px;">
                    <button (click)="addResena()" style="background: #4CAF50; color: white; padding: 6px 12px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Enviar</button>
                    <button (click)="showResenaForm = false" style="background: #ddd; color: #333; padding: 6px 12px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Cancelar</button>
                </div>
            </div>
        </div>

        <div class="comentarios" *ngIf="lugarSeleccionado?.comentarios?.length">
            <h3>Comentarios:</h3>
            <div *ngFor="let c of lugarSeleccionado.comentarios">
                <strong>{{ c.usuario }}</strong>: {{ c.texto }}
            </div>
        </div>
    </div>
</div>